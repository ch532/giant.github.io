<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Google IMA VAST Test</title>
  <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
  <style>
    #videoContainer {
      position: relative;
      width: 640px;
      height: 360px;
      background: black;
    }
    video {
      width: 100%;
      height: 100%;
    }
    #playButton {
      position: absolute;
      z-index: 2;
      top: 10px;
      left: 10px;
      padding: 8px 16px;
      background: #ffcc00;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="videoContainer">
    <button id="playButton">Play Ad</button>
    <video id="contentElement" preload="auto"></video>
  </div>

  <script>
    const adTagUrl = "https://s.magsrv.com/v1/vast.php?idzone=5688604"; // Your VAST tag
    const videoContent = document.getElementById('contentElement');
    const playButton = document.getElementById('playButton');

    let adsLoader;
    let adsManager;

    function initIMA() {
      const adDisplayContainer = new google.ima.AdDisplayContainer(
        document.getElementById('videoContainer'),
        videoContent
      );
      adDisplayContainer.initialize();

      const adsRequest = new google.ima.AdsRequest();
      adsRequest.adTagUrl = adTagUrl;
      adsRequest.linearAdSlotWidth = 640;
      adsRequest.linearAdSlotHeight = 360;
      adsRequest.nonLinearAdSlotWidth = 640;
      adsRequest.nonLinearAdSlotHeight = 150;

      adsLoader = new google.ima.AdsLoader(adDisplayContainer);

      adsLoader.addEventListener(
        google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
        (adsManagerLoadedEvent) => {
          adsManager = adsManagerLoadedEvent.getAdsManager(videoContent);
          adsManager.init(640, 360, google.ima.ViewMode.NORMAL);
          adsManager.start();
        },
        false
      );

      adsLoader.addEventListener(
        google.ima.AdErrorEvent.Type.AD_ERROR,
        (adErrorEvent) => {
          console.log("Ad Error:", adErrorEvent.getError());
          adsManager && adsManager.destroy();
        },
        false
      );

      adsLoader.requestAds(adsRequest);
    }

    playButton.addEventListener('click', () => {
      initIMA();
      playButton.style.display = 'none';
    });
  </script>

</body>
</html>
