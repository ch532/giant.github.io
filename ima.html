<!DOCTYPE html>
<html>
  <head>
    <title>IMA Ads with video.js</title>
    <link href="https://vjs.zencdn.net/7.21.1/video-js.css" rel="stylesheet" />
    <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script src="https://vjs.zencdn.net/7.21.1/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-ads@6.9.0/dist/videojs-contrib-ads.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.9.1/dist/videojs.ima.min.js"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
        background: #000;
      }
      .video-js {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <video
      id="my-video"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
      data-setup='{}'
    >
      <source src="https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4" />
    </video>

    <script>
      const player = videojs('my-video');

      player.ima({
        adTagUrl: 'https://s.magsrv.com/v1/vast.php?idzone=5688604',
        adsRenderingSettings: {
          enablePreloading: true
        },
        adLabel: 'Advertisement',
        debug: true
      });

      player.ready(function () {
        player.ima.requestAds();

        // Pre-roll
        player.on('readyforpreroll', function () {
          player.ima.initializeAdDisplayContainer();
          player.ima.start();
        });

        // Mid-roll at 10 seconds
        player.on('timeupdate', function () {
          const currentTime = player.currentTime();
          if (!player.hasMidRollPlayed && currentTime > 10) {
            player.hasMidRollPlayed = true;
            player.ima.requestAds();
            player.ima.initializeAdDisplayContainer();
            player.ima.start();
          }
        });

        // Post-roll when video ends
        player.on('ended', function () {
          player.ima.requestAds();
          player.ima.initializeAdDisplayContainer();
          player.ima.start();
        });
      });
    </script>
  </body>
</html>
