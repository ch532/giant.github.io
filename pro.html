<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IQ Pro</title>
<script src="https://bridge.playgama.com/v1/stable/playgama-bridge.js"></script>
<style>
:root{--bg:#000;--card:#1e1e1e;--accent:#0ea5a4;--muted:#999;}
html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);color:#fff}
.wrap{max-width:640px;margin:20px auto;padding:16px}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.6)}
h1{margin:6px 0 12px;font-size:22px}
.row{display:flex;gap:8px;align-items:center}
.spacer{flex:1}
#level,#coins{font-weight:600}
#question{margin:14px 0;font-size:18px;min-height:48px;color:#fff}
.answers{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.btn{background:#2a2a2a;border:0;padding:10px;border-radius:8px;color:#fff;font-size:15px;cursor:pointer}
.btn:active{transform:translateY(1px)}
.btn.primary{background:var(--accent)}
#message{min-height:24px;color:#ffd54d;margin-top:10px}
#timer{font-weight:600;margin:8px 0}
.small{font-size:13px;color:var(--muted)}
#controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
#game-over{display:none;text-align:center;padding:12px}
#hint{font-size:13px;color:#cfcfcf;margin-top:8px}
.meter{height:8px;background:#2a2a2a;border-radius:8px;overflow:hidden}
.meter > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#5eead4);width:0%}
#lives{margin-top:8px}
footer{margin-top:16px;text-align:center;color:var(--muted);font-size:13px}
#iap-buttons{display:flex;gap:8px;justify-content:center;margin-top:10px;flex-wrap:wrap}

/* Splash overlay */
#splash {
  position:fixed;
  inset:0;
  background:#000;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  flex-direction:column;
  gap:18px;
}
#splash img{ width:140px; height:auto; display:block; }
#splash h2{ margin:0; font-size:26px; color:#fff; font-weight:700; letter-spacing:0.5px;}

/* Console */
#console {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  max-height:150px;
  overflow-y:auto;
  background:rgba(0,0,0,0.8);
  color:#0f0;
  font-family:monospace;
  font-size:12px;
  padding:6px;
  z-index:9999;
}
</style>
</head>
<body>

<!-- Playgama SDK initialization -->
<script>
bridge.initialize()
  .then(() => {
    console.log('Playgama initialized');
  .catch(err=>console.warn('Playgama init error', err));
</script>

<!-- Splash overlay -->
<div id="splash">
  <img src="https://connectgold.sbs/gold-2.png" alt="Connect Gold logo">
  <h2>IQ Pro</h2>
</div>

<!-- Main game wrapper -->
<div class="wrap" id="gameWrap" style="display:none">
  <div class="card" id="ui-card">
    <div class="row">
      <h1>IQ Pro</h1>
      <div class="spacer"></div>
      <div id="level" class="small">Level: 1</div>
      <div style="width:12px"></div>
      <div id="coins" class="small">Coins: 0</div>
    </div>

    <div class="meter"><i id="meterFill"></i></div>
    <div id="timer" class="small">⏳ Time Left: 15s</div>
    <div id="question" aria-live="polite">Loading question...</div>

    <div class="answers" id="answers">
      <button class="btn" id="a">A</button>
      <button class="btn" id="b">B</button>
      <button class="btn" id="c">C</button>
      <button class="btn" id="d">D</button>
    </div>

    <div id="hint" class="small"></div>
    <div id="message"></div>

    <div id="controls">
      <button class="btn" id="pauseBtn">Pause</button>
      <button class="btn" id="playBtn">Play</button>
      <button class="btn" id="restartBtn">Restart</button>
      <button class="btn" id="skipBtn">Skip (10 coins)</button>
      <button class="btn" id="hintBtn">Reveal Hint (8 coins)</button>
      <button class="btn" id="watch-rewarded">Watch Ad → +20 coins</button>
      <button class="btn" id="daily-bonus">Daily +50</button>
    </div>

    <div id="lives" class="small">Lives: <span id="livesCount">3</span></div>

    <div id="game-over" class="card">
      <h2 id="go-title">Game Over</h2>
      <div id="go-info" class="small">You ran out of lives.</div>
      <div style="margin-top:12px">
        <button class="btn primary" id="restartOverBtn">Restart</button>
        <button class="btn" id="continueWithAd">Watch Ad to Continue (+1 life)</button>
      </div>
    </div>

    <div id="ad-container" style="margin-top:12px"></div>

    <div id="iap-buttons" style="margin-top:6px">
      <button class="btn" id="buy-50">Buy 50</button>
      <button class="btn" id="buy-100">Buy 100</button>
      <button class="btn" id="buy-200">Buy 200</button>
    </div>
  </div>

  <footer>
    <div class="small">Built with Playgama Bridge SDK • Test build</div>
  </footer>
</div>

<!-- Console -->
<div id="console"></div>

<script>
// Simple console wrapper
const c = document.getElementById('console');
function logConsole(...args){ c.innerHTML += args.join(' ') + '<br>'; c.scrollTop = c.scrollHeight; }
</script>

<!-- Splash then game start -->
<script>
window.addEventListener('load', ()=>{
  const splash = document.getElementById('splash');
  const gameWrap = document.getElementById('gameWrap');
  splash.style.display='flex';
  setTimeout(()=>{
    splash.style.display='none';
    gameWrap.style.display='block';
    startGame();
  },4000);
});
</script>

  <script>
// --- Game Variables ---
let questions = [];
for(let i=1;i<=200;i++){
  questions.push({ q: `Question ${i}?`, options:["A","B","C","D"], answer:"A" });
}

let current = 0;
let coins = 0;
let level = 1;
let lives = 3;
let timer = 15;
let timerInterval;
let isPaused = false;

// Elements
const questionEl = document.getElementById('question');
const aBtn = document.getElementById('a');
const bBtn = document.getElementById('b');
const cBtn = document.getElementById('c');
const dBtn = document.getElementById('d');
const timerEl = document.getElementById('timer');
const levelEl = document.getElementById('level');
const coinsEl = document.getElementById('coins');
const livesEl = document.getElementById('livesCount');
const messageEl = document.getElementById('message');
const meterFill = document.getElementById('meterFill');
const gameOverEl = document.getElementById('game-over');

// --- Playgama Storage ---
async function saveState() {
  await bridge.storage.set('coins', coins);
  await bridge.storage.set('level', level);
  await bridge.storage.set('lives', lives);
  logConsole('State saved');
}
async function loadState() {
  const savedCoins = await bridge.storage.get('coins');
  const savedLevel = await bridge.storage.get('level');
  const savedLives = await bridge.storage.get('lives');
  coins = savedCoins ?? 0;
  level = savedLevel ?? 1;
  lives = savedLives ?? 3;
  updateUI();
  logConsole('State loaded');
}

// --- UI Update ---
function updateUI(){
  coinsEl.textContent = `Coins: ${coins}`;
  levelEl.textContent = `Level: ${level}`;
  livesEl.textContent = lives;
}

// --- Show Question ---
function showQuestion(){
  if(current>=questions.length) current=0;
  const q = questions[current];
  questionEl.textContent = q.q;
  [aBtn,bBtn,cBtn,dBtn].forEach((btn,i)=>{
    btn.textContent = q.options[i];
    btn.onclick = ()=>{
      if(btn.textContent === q.answer){
        messageEl.textContent = "✅ Correct!";
        coins+=5;
        nextQuestion();
      }else{
        messageEl.textContent = "❌ Wrong!";
        lives--;
        if(lives<=0){ gameOver(); return; }
        nextQuestion();
      }
      updateUI();
      saveState();
    };
  });
  startTimer();
  updateMeter();
}

// --- Timer ---
function startTimer(){
  clearInterval(timerInterval);
  timer=15;
  timerEl.textContent = `⏳ Time Left: ${timer}s`;
  timerInterval = setInterval(()=>{
    if(isPaused) return;
    timer--;
    timerEl.textContent = `⏳ Time Left: ${timer}s`;
    updateMeter();
    if(timer<=0){
      clearInterval(timerInterval);
      lives--;
      if(lives<=0){ gameOver(); return; }
      messageEl.textContent = "⏳ Time out!";
      updateUI();
      saveState();
      setTimeout(nextQuestion,1000);
    }
  },1000);
}

// --- Progress Meter ---
function updateMeter(){
  const pct = (timer/15)*100;
  meterFill.style.width = `${pct}%`;
}

// --- Next Question ---
function nextQuestion(){
  current++;
  if(current%3===0){
    showInterstitialAd();
  }
  showQuestion();
}

// --- Game Over ---
function gameOver(){
  clearInterval(timerInterval);
  gameOverEl.style.display='block';
}

// --- Restart ---
document.getElementById('restartBtn').onclick = ()=>{
  current=0; coins=0; lives=3; level=1;
  gameOverEl.style.display='none';
  updateUI();
  showQuestion();
};

// --- Continue with Ad ---
document.getElementById('continueWithAd').onclick = ()=>{
  showRewardedAd(()=>{
    lives++;
    gameOverEl.style.display='none';
    updateUI();
    showQuestion();
  });
};

// --- Pause & Play ---
document.getElementById('pauseBtn').onclick = ()=>{ isPaused=true; messageEl.textContent='⏸ Paused'; };
document.getElementById('playBtn').onclick = ()=>{ isPaused=false; messageEl.textContent='▶ Playing'; };

// --- Skips & Hints ---
document.getElementById('skipBtn').onclick = ()=>{
  if(coins>=10){ coins-=10; nextQuestion(); updateUI(); saveState(); }
  else{ messageEl.textContent='Not enough coins!'; }
};
document.getElementById('hintBtn').onclick = ()=>{
  if(coins>=8){ coins-=8; messageEl.textContent='Hint: ' + questions[current].answer; updateUI(); saveState(); }
  else{ messageEl.textContent='Not enough coins!'; }
};

// --- Daily Bonus ---
document.getElementById('daily-bonus').onclick = ()=>{
  coins+=50; messageEl.textContent='Daily bonus added!'; updateUI(); saveState();
};

// --- IAP Buttons ---
document.getElementById('buy-50').onclick = ()=>{ coins+=50; updateUI(); saveState(); };
document.getElementById('buy-100').onclick = ()=>{ coins+=100; updateUI(); saveState(); };
document.getElementById('buy-200').onclick = ()=>{ coins+=200; updateUI(); saveState(); };

// --- Playgama Ads ---
function showRewardedAd(callback){
  bridge.ads.show('rewarded')
    .then(()=>{ logConsole('Rewarded ad shown'); callback(); })
    .catch(err=>logConsole('Rewarded ad error',err));
}
function showInterstitialAd(){
  bridge.ads.show('interstitial')
    .then(()=>logConsole('Interstitial ad shown'))
    .catch(err=>logConsole('Interstitial ad error',err));
}
function showBannerAd(){
  bridge.ads.show('banner',{container:'#ad-container'})
    .then(()=>logConsole('Banner ad shown'))
    .catch(err=>logConsole('Banner ad error',err));
}
</script>

</body>
</html>
