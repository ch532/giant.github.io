<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQ pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://bridge.playgama.com/v1/stable/playgama-bridge.js"></script>
</head>
<body>
<script>
    bridge.initialize()
    .then(() => {
        // initialization was successful, SDK can be used
    })
    .catch(error => {
        // error, something went wrong
    })
</script>
    
    <div id="game-container">
        <h1>Quiz Adventure</h1>
        <div id="level">Level: 1</div>
        <div id="coins">Coins: 0</div>
        <div id="question">Loading question...</div>
        <div id="answers">
            <button class="answer-btn" id="a">A</button>
            <button class="answer-btn" id="b">B</button>
            <button class="answer-btn" id="c">C</button>
            <button class="answer-btn" id="d">D</button>
        </div>
        <div id="ad-container"></div>
        <button id="watch-rewarded">Watch Ad for Coins</button>
        <button id="daily-bonus">Claim Daily Bonus</button>
    </div>

    <script>
window.addEventListener('load', async () => {
    const TOTAL_LEVELS = 200;
    let level = 1;
    let coins = 0;
    let lastDailyBonus = null;

    // Load saved progress
    try {
        const saved = await bridge.storage.get(['level','coins','lastDailyBonus']);
        level = saved.level || 1;
        coins = saved.coins || 0;
        lastDailyBonus = saved.lastDailyBonus || null;
    } catch(err){console.log(err);}

    // DOM elements
    const levelDiv = document.getElementById('level');
    const coinsDiv = document.getElementById('coins');
    const questionDiv = document.getElementById('question');
    const answerButtons = document.querySelectorAll('.answer-btn');

    function updateUI(){
        levelDiv.textContent = `Level: ${level}`;
        coinsDiv.textContent = `Coins: ${coins}`;
    }

    updateUI();

    // Example questions
    const questions = [];
    for(let i=1;i<=TOTAL_LEVELS;i++){
        questions.push({
            q: `Question ${i}: What is ${i}+${i}?`,
            a: `${i*2}`,
            options: [`${i+1}`,`${i*2}`,`${i}`,`${i-1}`]
        });
    }

    let currentQuestionIndex = level - 1;

    function loadQuestion(){
        const q = questions[currentQuestionIndex];
        questionDiv.textContent = q.q;
        ['a','b','c','d'].forEach((id,i)=>{
            document.getElementById(id).textContent = q.options[i];
        });
    }

    loadQuestion();

    // Answer click logic
    answerButtons.forEach(btn => {
        btn.addEventListener('click', async () => {
            const selected = btn.textContent;
            const correct = questions[currentQuestionIndex].a;

            if(selected === correct){
                coins += 10;
                if(level < TOTAL_LEVELS) level++;
                alert('Correct! +10 coins');
            } else {
                if(level > 1) level--; // go back by 1 level
                alert('Wrong! You go back one level.');
            }

            currentQuestionIndex = level - 1;
            loadQuestion();
            updateUI();

            // Save progress
            try{
                await bridge.storage.set({level, coins, lastDailyBonus});
            } catch(err){console.log(err);}
        });
    });

    // Rewarded ad button
    const rewardedBtn = document.getElementById('watch-rewarded');
    rewardedBtn.addEventListener('click', () => {
        if(bridge.advertisement.isRewardedSupported){
            bridge.advertisement.showRewarded('rewarded_placement');
        }
    });

    bridge.advertisement.on(bridge.EVENT_NAME.REWARDED_STATE_CHANGED, state => {
        if(state === 'rewarded'){
            coins += 20;
            alert('You earned +20 coins from the ad!');
            updateUI();
            bridge.storage.set({level, coins, lastDailyBonus}).catch(err=>console.log(err));
        }
    });

    // Daily bonus
    const dailyBtn = document.getElementById('daily-bonus');
    dailyBtn.addEventListener('click', async () => {
        const today = new Date().toDateString();
        if(lastDailyBonus !== today){
            coins += 50;
            lastDailyBonus = today;
            alert('Daily bonus claimed! +50 coins');
            updateUI();
            try{ await bridge.storage.set({level, coins, lastDailyBonus}); } catch(err){console.log(err);}
        } else {
            alert('You already claimed today\'s bonus.');
        }
    });

    // Banner ads
    if(bridge.advertisement.isBannerSupported){
        bridge.advertisement.showBanner('bottom','test_banner');
        bridge.advertisement.on(bridge.EVENT_NAME.BANNER_STATE_CHANGED,state=>console.log('Banner state:', state));
    }

    // Player authorization
    if(bridge.player.isAuthorizationSupported){
        bridge.player.authorize({}).then(()=>console.log('Player authorized')).catch(err=>console.log(err));
    }

    // Achievements
    if(bridge.achievements.isSupported){
        bridge.achievements.getList({}).then(list=>console.log('Achievements:',list)).catch(err=>console.log(err));
    }

    // Social share
    if(bridge.social.isShareSupported){
        bridge.social.share({text:'I am playing 200-Level Quiz Adventure!'})
        .then(()=>console.log('Shared successfully')).catch(err=>console.log('Share error',err));
    }

    updateUI();
});
</script>
